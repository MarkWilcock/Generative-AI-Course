# Use AI Tools for SQL

We can use AI tools to write SQL statements. We  provide a description of the task in English.  For best results, we provide an initial prompt with details of the names of the tables and columns that we want the SQL statement to refer to.  We can also provide other information: column descriptions, types, primary  and foreign keys, but this is often unnecessary.

## Exercise 1: Analyse the 'Patient Stay' dataset

Download the (fictitious) dataset for this example from [here](./Resources/PatientStay.csv). Have a look at the data and form your own opinions about how you would analyse it. Then start a new conversation with your LLM  using the prompts below as a starter.

_Prompt 1:_ Act as a helpful SQL expert. The `PatientStay` table represents patients admitted to a ward in a hospital. Each row in the table represents a patient admission.  The dataset contains the following columns.

- `PatientId` (int): The unique ID of the patient.
- `AdmittedDate` (date): The date on which the patient was admitted to the hospital.
- `DischargeDate` (date): The date on which the patient was discharged from the hospital.
- `Hospital` (varchar): The name of the hospital.
- `Ward` (varchar): The name of the ward.
- `Tariff` (float): The cost to treat the patient.
- `Ethnicity` (varchar): The ethnicity of the patient e.g., White, Asian. For some rows this value is missing (null).

_Prompt 2:_ Suggest some data analysis questions that could be answered with this dataset.

_Prompt 3:_ Write a SQL statement to list the patients that were admitted to either "Guy's Hospital" or "St Georges".

_Prompt 4:_ Write a SQL statement to list the patients that were admitted between two dates.


## Exercise 2: Analyse  the PricePaid dataset

The data in this exercise comes from the public Price Paid dataset from the Land Registry.  Each row represents  the sale of a property in England.  Full details of the data are provided in the example prompts below.  The Land Registry site that describes this data is [here](https://www.gov.uk/government/statistical-data-sets/price-paid-data-downloads)

The prompts refer to a table named PricePaidSW12.  This is a subset of the full England dataset, with data for a single area in London.
In this exercise, you may or may not have access to a SQL editor that has a connection to a database that contains this table.  If you do, you can copy / paste the SQL queries generated by the AI tool into the editor and see if they are correct.  If not, you can simply inspect the SQL to see if it is well written and probably correct.

Have a conversation about this data with your LLM and task it with writing SQL queries based on your instructions.  The example prompts below start with simple queries and progressively become more challenging queries.  Use these prompts as a starting position; feel free to add,  change or replace these prompts based on the AI's responses and any testing you are able to do.


_Prompt 1:_
Act as a  SQL expert. Keep your responses brief.  Use the Microsoft T-SQL version in your code examples in your responses.

_Prompt 2:_
I will ask you to write SQL queries to analyse data in a table PricePaidSW12.  This lists about 18,000 property sales in the London SW12 post code in the last 25 years.
The most important fields in the PricePaidSW12 table are:
* TransactionID, a unique surrogate key
* Price, the price paid for the property in pounds (£)
* TransactionDate, the date of the transaction
* PropertyType, which must be one of five values, D, S, T, F, O. (D = Detached, F = Flat, S = Semi-detached, T = Terraced, O = Other)
* IsNew, which must be either Y or N. Yes indicates a new build property.
* Duration, which must be either L or F. L indicates Leasehold, F indicates Freehold.
* Postcode. This is in the format with a space between the two parts e.g. SW12 0AA. About 20 – 30 properties have the same postcode but the combination of postcode and PAON (house number) is nearly always unique.

The data also contains several other fields about the address:
* PAON, Primary Addressable Object Name (typically the house number or name)
* SAON, Secondary Addressable Object Name – if there is a sub-building, for example, the building is divided into flats, there will be a SAON
* Street
* Locality
* Town/City
* District
* County

_Prompt 3:_
Write SQL queries to show how many sales took place in total and how many each year? 

_Prompt 4:_
Write a SQL query to show the total market value (Price) of all the sales each year.

_Prompt 5:_
What are the earliest and latest dates of a sale?

_Prompt 6:_
How many different property types are there? And how many different values of IsNew,  Duration?

_Prompt 7:_
List all the sales in 2018 between £400,000 and £500,000 in Cambray Road. Provide these details: date, price, property type, post code, PAON and street.

_Prompt 8:_
List the 25 latest sales in Ormeley Road with the following fields
* TransactionDate, 
* Price, 
* post code, 
* PAON, 
* FreeholdOrLeasehold, based on Duration and returns Freehold or Leasehold
* IsNewBuild that returns either Yes or No
* Property Type Name: use the full name e.g., 'Detached' rather than the single letter code e.g., 'D'


_Prompt 9:_
List properties that have been sold three times or more in the last ten years. Assume that a property is uniquely identified by the combination of the postcode, PAON and SAON fields.


